---
layout: post
title: '应急响应第一课'
subtitle: '应急响应第一课'
date: 2021-09-02
categories: 技术
cover: 'http://on2171g4d.bkt.clouddn.com/jekyll-theme-h2o-postcover.jpg'
tags: 应急响应
---

### 应急响应基础

1.什么是应急响应？

	“应急响应”对应的英文是“Incident Response”或“Emergency Response”等，通常是指一个组织为了应对各种意外事件的发生所做的准备以及在事件发生后所采取的措施。

2.应急响应的两个方面

	未雨绸缪：
	即在事件发生前事先做好准备，比如风险评估、制定安全计划、安全意识的培训、以发布安全通告的方式进行的预警、以及各种防范措施。
	亡羊补牢：
	即在事件发生后采取的措施，其目的在于把事件造成的损失降到最小。这些行动措施可能来自于人，也可能来自系统，比如发现事件发生后，系统备份、病毒检测、后门检测、清除病毒或后门、隔离、系统恢复、调查与追踪、入侵者取证等一系列操作。
	以上两个方面的工作是相互补充的。首先，事前的计划和准备为事件发生后的响应动作提供了指导框架，否则，响应动作将陷入混乱，而这些毫无章法的响应动作有可能造成比事件本身更大的损失；其次，事后的响应可能发现事前计划的不足，吸取教训，从而进一步完善安全计划。因此，这两个方面应该形成一种正反馈的机制，逐步强化组织的安全防范体系。

### 应急响应的基本流程

![](https://1024861435.github.io/assets/img/应急响应第一课1.png)

> 1.信息收集

收集客户信息和中毒主机信息，包括样本。  

	感染主机数  	      感染了多数台主机  
	补丁情况  	      打了哪些补丁，是否存在补丁漏打  
	中毒现象  	      勒索/挖矿/DoS/僵尸网络/后门/木马  
	帐号密码  	  	  确认是否有弱密码  
	对外开放端口  	  对外开放了哪些端口  
	开启的服务  	      开启了哪些服务  
	操作系统版本  	  操作系统版本信息  
	客户需求  	      确认客户具体需求

> 2.类型判断

判断是否是安全事件，何种安全事件，勒索、挖矿、webshell等等。

> 3.原因分析

日志分析、进程分析、启动项分析、样本分析。

> 4.事件处置

直接杀掉进程，删除文件，打补丁，抑或是修复文件。

> 5.编写报告

整理并输出完整的安全事件报告。

### 应急响应的原则

	3W1H原则：3W即Who、What、Why，1H即How，做应急响应要带着疑问来做事，一定要收集清楚这些信息。网络拓扑是怎么样的？需求是啥？发生了什么事？你能做什么？用户用了什么产品？产品版本多少？病毒库版本多少？多少主机中了？主机是普通PC还是服务器？服务器是做什么的？……信息收集越多，对应急响应越有利。
	易失性原则：做应急响应免不了要做信息收集和取证的，但这里是有一定的先后顺序的，即最容易丢失的据，应该最先收集，其它的依次类推。
	要素原则：做应急响应，主要是抓关键证据，即要素，这些要素包括样本、流量、日志、进程及模块、内存、启动项。
	避害原则：做应急响应，要做到趋利避害，不能问题还没有解决，反而引入了新的问题。譬如，自己使用的工具被感染而不知情；给用户使用不恰当的工具或软件造成客户主机出现问题；给别人发样本，不加密，不压缩，导致别人误点中毒，最极端的场景就是给别人发勒索样本不加密压缩，导致别人误点中毒。

### 技能和工具的简介

> 1.应急响应的技能、知识点与工具

	应急工具集：应急响应必要的一套工具集合，可协助应急人员做分析，提高效率。
	日志分析：能对日志进行分析，包括但不限于系统日志（Windows/Linux等）、应用日志、安全设备日志（防火墙、防病毒、态势感知等）。
	威胁情报：安全事件可能不是孤立的，安全站点或搜索站点能找到安全事件的关联信息。
	漏洞补丁知识：知道漏洞与补丁的关系，它们在应急响应中的角色，了解常见漏洞及补丁。
	常见病毒及分类：知道病毒大致的分类以及常见的病毒。
	样本分析：至少能对样本进行一次简单动态的分析。
	操作系统知识：至少对Windows系统和Linux系统的有一定的知识储备，知道其基础的工作原理

> 2.威胁情报

	谷歌：www.google.com
	百度：www.baidu.com
	Virustotal：www.virustotal.com
	微步在线：x.threatbook.cn
	腾讯哈勃：habo.qq.com
	Virscan：virusscan.jotti.org
	Freebuf：www.freebuf.com
	深信服威胁分析平台：wiki.sec.sangfor.com.cn

> 3.常用工具

Webshell：

	Webshell是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门。黑客在入侵了一个网站后门，通常会将asp或php后门文件与网站服务器WEB目录下正常的网页文件混在一起，然后就可以使用浏览器来访问asp或者php后门，得到一个命令执行环境，以达到控制网站服务器的目的。

常用的webshell查杀工具如下表：
	
	名称						平台					下载
	D盾						windows				http://www.d99net.net/
	悬镜						linux				http://www.xmirror.cn/
	360主机卫士				windows / linux		http://zhuji.360.cn/
	河马webshell				windows / linux		http://www.webshell.pub/
	安全狗					windows / linux		http://www.safedog.cn/
	SangforWebshellKiller	windows / linux		https://edr.sangfor.com.cn/tool/WebShellKillerTool.zip 

D盾:

	工具扫描
	D盾扫描结果判断：
	级别为3-5的，后门的概率较大
	级别为4和5的基本可以确定为后门
	级别为2-3，需要结合其他特征分析
	级别为1的，误报概率较高
	确认webshell之后查杀即可

河马Webshell:

	河马Webshell功能：

		在线webshell查杀
		本地webshell查杀
	
	使用方法：

		下载64位版本 wget -O hm-linux.tgz http://dl.shellpub.com/hm/latest/hm-linux-amd64.tgz?version=1.5.0
		下载32位版本 wget -O hm-linux.tgz http://dl.shellpub.com/hm/latest/hm-linux-386.tgz?version=1.5.0
		解压 tar zxvf hm-linux.tgz
		帮助文档 hm -h
		扫描后门  hm scan /var/www/html/
		升级  hm update
		编译完成没有报错的话执行检查
		./chkrootkit

Process Hacker:
	
	功能：
	ProcessHacker是一款不错的进程分析工具，可查看所有进程信息，包括进程加载的dll、进程打开的文件、进程读写的注册表……，也可以将特定进程的内存空间Dump到本地，此外还可以查看网络连接。

PC Hunter:

	功能：
	PC Hunter是一个Windows系统信息查看软件，同时也是一个手工杀毒辅助软件。目前软件支持xp~win10的所有32位操作系统，还支持64位的Win7、Win8、Win8.1和Win10系统。
		
		1.进程、线程、进程模块、进程窗口、进程内存信息查看，杀进程、杀线程、卸载模块等功能
		2.内核驱动模块查看，支持内核驱动模块的内存拷贝
		3.SSDT、Shadow SSDT、FSD、KBD、TCPIP、Classpnp、Atapi、Acpi、SCSI、IDT、GDT信息查看，并能检测和恢复ssdt hook和inline hook
		4.CreateProcess、CreateThread、LoadImage、CmpCallback、BugCheckCallback、Shutdown、Lego等Notify Routine信息查看，并支持对这些Notify Routine的删除
		5.端口信息查看，目前不支持2000系统
		6.查看消息钩子
		7.内核模块的iat、eat、inline hook、patches检测和恢复
		8.磁盘、卷、键盘、网络层等过滤驱动检测，并支持删除
		9.注册表编辑
		10.进程iat、eat、inline hook、patches检测和恢复
		11.文件系统查看，支持基本的文件操作
		12.查看（编辑）IE插件、SPI、启动项、服务、Host文件、映像劫持、文件关联、系统防火墙规则、IME
		13.ObjectType Hook检测和恢复
		14.DPC定时器检测和删除
		15.MBR Rootkit检测和修复
		16.内核对象劫持检测
		17.WorkerThread枚举
		18.Ndis中一些回调信息枚举
		19.硬件调试寄存器、调试相关API检测
		20.枚举SFilter/Fltmgr的回调
		21.系统用户名检测

火绒剑:

	功能：
	综合性工具。

LastActivityView:

	功能：
	历史操作查看工具。（命令行的无法查看，仅能查看图形化界面操作的记录）

Autoruns:
	
	功能：
	一款不错的启动项分析工具，微软官方推荐。只要涉及到启动项相关的信息，事无巨细，通通都可以查询得到，非常方便找到病毒的启动项。

evtxLogparser:

	功能：
	windows rdp/smb登录日志分析。
	RDP登录成功日志：evtxLogparse.exe -r success 1.evtx
	SMB登录失败日志：evtxLogparse.exe -s fail 1.evtx

everything：

	功能：
	Everything是voidtools开发的一款文件搜索工具，官网描述为“基于名称实时定位文件和目录（Locate files and folders by name instantly）”。
	名称支持通配符、正则表达式检索
	支持文件内容搜索
	支持搭建简易FTP/HTTP服务器
	过滤C:\windows\下的exe文件： *.exe C:\windows\
	过滤关键词： content:hacker C:\windows\

### 常见的病毒

传统病毒:
	
	第一个病毒诞生后，许多黑客也涌入到了制作病毒的潮流中，一时间，由于当时计算机的安全防护较差，病毒开始大肆传播，破坏类型也五花八门，如：强制死机、清除磁盘、恶意控制，等等。当时的黑客编写病毒纯粹就是为了搞搞恶作剧，彰显自己的能力，没有涉及任何利益。
	最典型的就是熊猫烧香，该病毒运行后会感染其它合法程序，并通过网络、U盘等方式进行传播，受感染的计算机还会出现蓝屏、频繁重启以及系统硬盘中数据文件被破坏等现象。
	可见传统病毒的特性就是破坏性强、传播范围广，而且由于隐蔽性差，用户一般很容易察觉出这些病毒。

新型病毒:
	
	没有利益驱动的病毒是不长久的，黑客们开始慢慢的使用病毒获取利益。震网病毒（Stuxnet）是最典型的例子，美国人编写的震网病毒潜伏在控制伊朗离心机的计算机中，并一直对离心机进行控制和破坏，导致伊朗的核计划推迟了整整两年。
	最近两年，随着数字货币的兴起，勒索病毒和挖矿病毒也成了病毒界的主导，这两种病毒都能通过数字货币给作者带来直接利益。

病毒分类:

随着病毒的利益化，传统的纯破坏性病毒已经消失了，现在常见的病毒分为三类：潜伏控制类、脚本类、数字货币类。

蠕虫病毒:蠕虫病毒的特点是传播性极强，一旦一台计算机中了蠕虫病毒，这个病毒就会通过网络、邮件等其他方式对外进行传播，从而导致大量的计算机被感染控制，受感染的计算机称为肉鸡，它们一般会被C&C服务器操纵，来实行DDOS攻击。

木马病毒:木马病毒的特点是隐蔽性强，木马病毒一旦运行，就会将自己藏在合法进程或注册表中，使得用户难以发现，而且由于计算机重启后它也会重新启动，所以会一直潜伏在主机里。木马病毒多数用于监控用户行为或盗取用户数据。

脚本病毒:脚本病毒顾名思义就是使用各种脚本编写的轻量级病毒，典型的有VBS病毒、JS病毒、Powershell病毒。脚本病毒通过少量的脚本实现了二进制病毒所能实现的功能，同时可以运用到无文件攻击中去，故而越来越受到黑客的青睐。

宏病毒:
宏是微软公司为其Office软件包设计的一个特殊功能，由于其功能强大，使得黑客可以通过精心构造的宏代码来实现恶意操作，这些代码就叫做宏病毒。
宏病毒常以垃圾邮件的方式对用户进行攻击，因为伪造的Office文档不容易引起用户的怀疑，所以当用户毫无防备的打开Office文档后，宏病毒便开始了运行，对用户主机进行恶意操作。
现在微软对宏病毒的防御已经做得很好了，一般情况下除非用户开启宏功能，Office都是默认将其关闭的。

勒索病毒:不断增值的比特币和一夜成名的Wanncry，使得勒索病毒成为了病毒界的MVP。勒索病毒使用复杂的加密算法加密用户计算机中的重要文件，使得用户被迫交付勒索金来解密文件。勒索软件是市面上危害性最大，同时也是较难防御的一种病毒。

挖矿病毒:相比于勒索病毒索求高额比特币，挖矿病毒的收益来的更为稳定。挖矿病毒启动一个进程，然后占用高CPU使用率进行挖矿，挖到数字货币后就上传到黑客的钱包中，由于其会导致用户计算机的严重卡顿，所以对公司的业务也有极大的危害。








